{"componentChunkName":"component---src-templates-blog-post-js","path":"/node/ë‹¨ë°©í–¥-ì•”í˜¸í™”---salting/","result":{"data":{"site":{"siteMetadata":{"title":"Study Log","author":"[HongDongUk]","siteUrl":"https://donguk.netlify.com","comment":{"disqusShortName":"","utterances":"doonguk/doonguk.github.io"},"sponsor":{"buyMeACoffeeId":"doonguk"}}},"markdownRemark":{"id":"5d453574-8a4a-53fe-9898-077a0e10482c","excerpt":"ë¹„ë°€ë²ˆí˜¸ ì•ˆì „í•˜ê²Œ ì €ì¥í•˜ê¸° BY Salt ë“¤ì–´ê°€ê¸° ì „ì—! DatabaseëŠ” key-databaseì¸ levelDBë¥¼ ì‚¬ìš© íšŒì›ê°€ì…í•  ë•Œ idë¡œ ì‚¬ìš©ì ì •ë³´ë¥¼ êµ¬ë¶„í•´ì„œ dbì— ì €ì¥í–ˆìŒ. APIëŠ” ì„¤ëª…ìš©ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í–ˆìŒ ğŸ¤” ë‹¨ë°©í–¥ ì•”í˜¸í™” Salt ë°©ì‹ì€ ë‹¨ë°©í–¥ ì•”í˜¸í™” ë°©ì‹ì´ë‹¤. í•œë²ˆ ì•”í˜¸í™”í•˜ë©´ ë³µí˜¸í™”í•  ìˆ˜ ì—†ë‹¤. ë‹¨ë°©í–¥ ì•”í˜¸í™” ë°©ì‹ì„ ì‚¬ìš©í•œ ì´ìœ ëŠ” í™ˆí˜ì´ì§€ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³µí˜¸í™”í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. ì•”í˜¸í™”í•œ ê°’ì„ DBì— ì €ì¥í•˜ê³  ë‚˜ì¤‘ì— ë¡œê·¸ì¸í•  ë•Œ ì…ë ¥ë°›ì€ ê°’ì„ ì•”í˜¸í™”í•˜ì—¬ DBâ€¦","html":"<h1 id=\"ë¹„ë°€ë²ˆí˜¸-ì•ˆì „í•˜ê²Œ-ì €ì¥í•˜ê¸°-by-salt\"><a href=\"#%EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8-%EC%95%88%EC%A0%84%ED%95%98%EA%B2%8C-%EC%A0%80%EC%9E%A5%ED%95%98%EA%B8%B0-by-salt\" aria-label=\"ë¹„ë°€ë²ˆí˜¸ ì•ˆì „í•˜ê²Œ ì €ì¥í•˜ê¸° by salt permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ë¹„ë°€ë²ˆí˜¸ ì•ˆì „í•˜ê²Œ ì €ì¥í•˜ê¸° BY Salt</h1>\n<blockquote>\n<p>ë“¤ì–´ê°€ê¸° ì „ì—!</p>\n<ol>\n<li>DatabaseëŠ” key-databaseì¸ levelDBë¥¼ ì‚¬ìš©</li>\n<li>íšŒì›ê°€ì…í•  ë•Œ idë¡œ ì‚¬ìš©ì ì •ë³´ë¥¼ êµ¬ë¶„í•´ì„œ dbì— ì €ì¥í–ˆìŒ.</li>\n<li>APIëŠ” ì„¤ëª…ìš©ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í–ˆìŒ</li>\n</ol>\n</blockquote>\n<h3 id=\"-ë‹¨ë°©í–¥-ì•”í˜¸í™”\"><a href=\"#-%EB%8B%A8%EB%B0%A9%ED%96%A5-%EC%95%94%ED%98%B8%ED%99%94\" aria-label=\" ë‹¨ë°©í–¥ ì•”í˜¸í™” permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ¤” ë‹¨ë°©í–¥ ì•”í˜¸í™”</h3>\n<p>Salt ë°©ì‹ì€ ë‹¨ë°©í–¥ ì•”í˜¸í™” ë°©ì‹ì´ë‹¤. í•œë²ˆ ì•”í˜¸í™”í•˜ë©´ ë³µí˜¸í™”í•  ìˆ˜ ì—†ë‹¤.</p>\n<p>ë‹¨ë°©í–¥ ì•”í˜¸í™” ë°©ì‹ì„ ì‚¬ìš©í•œ ì´ìœ ëŠ” í™ˆí˜ì´ì§€ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³µí˜¸í™”í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. ì•”í˜¸í™”í•œ ê°’ì„ DBì— ì €ì¥í•˜ê³  ë‚˜ì¤‘ì— ë¡œê·¸ì¸í•  ë•Œ ì…ë ¥ë°›ì€ ê°’ì„ ì•”í˜¸í™”í•˜ì—¬ DBì— ì €ì¥ëœ ê°’ê³¼ ë¹„êµí•˜ë©´ ë˜ê¸° ë•Œë¬¸ì´ë‹¤.</p>\n<h3 id=\"-í•„ìš”-ëª¨ë“ˆ\"><a href=\"#-%ED%95%84%EC%9A%94-%EB%AA%A8%EB%93%88\" aria-label=\" í•„ìš” ëª¨ë“ˆ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ˜‡ í•„ìš” ëª¨ë“ˆ</h3>\n<p>ë‚´ì¥ ëª¨ë“ˆì¸ <code class=\"language-text\">crypto</code> ì´ìš©</p>\n<h3 id=\"-ì½”ë“œ-íë¦„\"><a href=\"#-%EC%BD%94%EB%93%9C-%ED%9D%90%EB%A6%84\" aria-label=\" ì½”ë“œ íë¦„ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ˜¸ ì½”ë“œ íë¦„</h3>\n<ol>\n<li>íšŒì›ê°€ì… APIì—ì„œ salt ìƒì„±</li>\n<li>ìƒì„±í•œ saltì™€ í•´ì‹± ì•Œê³ ë¦¬ì¦˜ì„ ì´ìš©í•´ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ í•´ì‹œ</li>\n<li>í•´ì‹±ëœ ë¹„ë°€ë²ˆí˜¸ì™€ saltë¥¼ ìœ ì €ì •ë³´ì™€ í•¨ê»˜ DBì— ì €ì¥</li>\n<li>ë¡œê·¸ì¸ APIì—ì„œ ì…ë ¥ë°›ì€ idì— ë§ëŠ” ìœ ì €ì •ë³´ ê°€ì ¸ì˜´</li>\n<li>4ë²ˆì—ì„œ ê°€ì ¸ì˜¨ ìœ ì €ì •ë³´ì—ì„œ saltë¥¼ ê°€ì ¸ì˜¤ê³  ë¡œê·¸ì¸í•  ë•Œ ì…ë ¥ë°›ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ 2ë²ˆì—ì„œ í–ˆë˜ ë°©ì‹ìœ¼ë¡œ í•´ì‹±</li>\n<li>í•´ì‹±ëœ ê°’ê³¼ 4ë²ˆì—ì„œ ê°€ì ¸ì˜¨ ìœ ì €ì •ë³´ì— ì €ì¥ëœ í•´ì‹±ëœ ë¹„ë°€ë²ˆí˜¸ê°€ ê°™ë‹¤ë©´ ê°™ì€ ìœ ì €.</li>\n</ol>\n<h3 id=\"-ì½”ë“œ\"><a href=\"#-%EC%BD%94%EB%93%9C\" aria-label=\" ì½”ë“œ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ğŸ–¥ ì½”ë“œ</h3>\n<p><strong>íšŒì›ê°€ì… APIì—ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ í•´ì‹±í•´ì„œ ì €ì¥í•œë‹¤.</strong></p>\n<p><strong>1. Salt ìƒì„±</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> express<span class=\"token punctuation\">.</span><span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> crypto <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crypto'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">generateRandomHash</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">length</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> crypto\n    <span class=\"token punctuation\">.</span><span class=\"token function\">randomBytes</span><span class=\"token punctuation\">(</span>length<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/[^A-Za-z0-9]/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">createPasswordHash</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">password</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> salt <span class=\"token operator\">=</span> <span class=\"token function\">generateRandomHash</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span>\n      crypto<span class=\"token punctuation\">.</span><span class=\"token function\">pbkdf2</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">,</span> salt<span class=\"token punctuation\">,</span> <span class=\"token number\">104236</span><span class=\"token punctuation\">,</span> <span class=\"token number\">64</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sha512'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> password<span class=\"token punctuation\">:</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> salt <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/user'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// íšŒì›ê°€ì… API</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">,</span> password <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>body\n    <span class=\"token keyword\">const</span> passwordHash <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createPasswordHash</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span>\n  \t<span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">next</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>ìš°ì„ </p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">generateRandomHash</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">length</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> crypto\n    <span class=\"token punctuation\">.</span><span class=\"token function\">randomBytes</span><span class=\"token punctuation\">(</span>length<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/[^A-Za-z0-9]/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">randomBytes</code> ë©”ì†Œë“œë¡œ length ê°’ ë§Œí¼ì˜ Bufferë¥¼ ìƒì„±í•œë‹¤.</p>\n<p><code class=\"language-text\">toString</code> ë©”ì†Œë“œë¡œ base64 ë¬¸ìì—´ë¡œ ë³€í™˜í•´ì¤€ë‹¤.</p>\n<p>ì •ê·œì‹ìœ¼ë¡œ ì•ŒíŒŒë²³, ìˆ«ìì•„ë‹ˆë©´ <code class=\"language-text\">&#39;&#39;</code>ë¡œ ë°”ê¿”ì¤€ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">createPasswordHash</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">password</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> salt <span class=\"token operator\">=</span> <span class=\"token function\">generateRandomHash</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span>\n      crypto<span class=\"token punctuation\">.</span><span class=\"token function\">pbkdf2</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">,</span> salt<span class=\"token punctuation\">,</span> <span class=\"token number\">104236</span><span class=\"token punctuation\">,</span> <span class=\"token number\">64</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sha512'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> password<span class=\"token punctuation\">:</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> salt <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">pbkdf2</code> ë©”ì†Œë“œë¥¼ í†µí•´ì„œ ë‹¨ë°©í–¥ ì•”í˜¸í™”. <code class=\"language-text\">pbkdf2</code>ëŠ” 5ê°œì˜ ì¸ìë¥¼ ë°›ëŠ”ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">crypto<span class=\"token punctuation\">.</span><span class=\"token function\">pbkdf2</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'ì…ë ¥ë¹„ë°€ë²ˆí˜¸'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'salt'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'ë°˜ë³µí•˜ëŠ” íšŸìˆ˜'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'ë¹„ë°€ë²ˆí˜¸ ê¸¸ì´'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'í•´ì‹œ ì•Œê³ ë¦¬ì¦˜'</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>ì½œë°±ìœ¼ë¡œ ì „ë‹¬ë˜ëŠ” í•´ì‹± ê²°ê³¼ê°’ì€ Bufferì´ê¸° ë•Œë¬¸ì— base64 ë¬¸ìì—´ë¡œ ë³€í™˜ í›„ <code class=\"language-text\">salt</code> ì™€ í•¨ê»˜ ë¦¬í„´í•œë‹¤.</p>\n<p>( DBì— Saltë„ ì €ì¥í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ê¼­ ê°™ì´ ë¦¬í„´í•œë‹¤. )</p>\n<p><strong>2. í•´ì‹±ëœ ë¹„ë°€ë²ˆí˜¸ì™€ Saltë¥¼ DBì— ì €ì¥</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">...</span>ìƒëµ\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/user'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// íšŒì›ê°€ì… API</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">,</span> password <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>body\n    <span class=\"token keyword\">const</span> passwordHash <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">createPasswordHash</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">await</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// dbì— ë„£ê¸°</span>\n      <span class=\"token operator\">...</span>req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span>\n      password<span class=\"token punctuation\">:</span> passwordHash<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">,</span>\n      salt<span class=\"token punctuation\">:</span> passwordHash<span class=\"token punctuation\">.</span>salt<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">201</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">next</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>ë¡œê·¸ì¸í•  ë•Œ ì…ë ¥ìœ¼ë¡œ ë°›ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ í˜„ì¬ saltë¥¼ ì´ìš©í•´ì„œ ê²€ì¦í•˜ë‹ˆ DBì— ê°™ì´ ì €ì¥</p>\n<br/>\n<p><strong>ë¡œê·¸ì¸ ê²€ì¦í•˜ê¸°</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token operator\">...</span>ìƒëµ\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">verifyPassword</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">password<span class=\"token punctuation\">,</span> passwordHash<span class=\"token punctuation\">,</span> salt</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      crypto<span class=\"token punctuation\">.</span><span class=\"token function\">pbkdf2</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">,</span> salt<span class=\"token punctuation\">,</span> <span class=\"token number\">104236</span><span class=\"token punctuation\">,</span> <span class=\"token number\">64</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sha512'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> passwordHash<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/user/auth'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// ë¡œê·¸ì¸ API</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> id<span class=\"token punctuation\">,</span> password <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>body\n    <span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token comment\">// levelDB -> idì— í•´ë‹¹í•˜ëŠ” ìœ ì € ê°€ì ¸ì˜´</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// ì—†ëŠ” ìœ ì €</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">verifyPassword</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">.</span>salt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token punctuation\">:</span> user<span class=\"token punctuation\">.</span>name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸ ê°™ìŒ</span>\n    <span class=\"token punctuation\">}</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">403</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// ë¹„ë°€ë²ˆí˜¸ í‹€ë¦¼</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">next</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>ë¡œê·¸ì¸ APIê°€ í˜¸ì¶œë˜ë©´, ìœ„ì— ì •ì˜í•œ <code class=\"language-text\">verifyPassword</code> ë©”ì†Œë“œë¡œ ì…ë ¥ë°›ì€ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥¸ì§€ ê²€ì¦í•œë‹¤. ì´ë•Œ DBì—ì„œ ê°€ì ¸ì˜¨ user ê°ì²´ì˜ <code class=\"language-text\">salt</code>ë¥¼ ê°™ì´ ì „ë‹¬í•œë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">verifyPassword</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">password<span class=\"token punctuation\">,</span> passwordHash<span class=\"token punctuation\">,</span> salt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      crypto<span class=\"token punctuation\">.</span><span class=\"token function\">pbkdf2</span><span class=\"token punctuation\">(</span>password<span class=\"token punctuation\">,</span> salt<span class=\"token punctuation\">,</span> <span class=\"token number\">104236</span><span class=\"token punctuation\">,</span> <span class=\"token number\">64</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sha512'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> key</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> passwordHash<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ê²€ì¦í•˜ëŠ” ë°©ì‹ì€ íšŒì›ê°€ì…í•  ë•Œ ë¹„ë°€ë²ˆí˜¸ë¥¼ í•´ì‹±í•˜ëŠ” ê³¼ì •ê³¼ ê°™ë‹¤. í•˜ì§€ë§Œ <code class=\"language-text\">salt</code>ë¥¼ ì¸ìë¡œ ë°›ì€ ì ì—ì„œ ë‹¤ë¥´ë‹¤.</p>","frontmatter":{"title":"ë‹¨ë°©í–¥ ì•”í˜¸í™” - Salting","date":"July 08, 2020"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/node/ë‹¨ë°©í–¥-ì•”í˜¸í™”---salting/","previous":{"fields":{"slug":"/html/íƒœê·¸-í•´ë¶€í•™(1)/"},"frontmatter":{"title":"íƒœê·¸ í•´ë¶€í•™(1)","category":"html"}},"next":{"fields":{"slug":"/html/íƒœê·¸-í•´ë¶€í•™(2)/"},"frontmatter":{"title":"íƒœê·¸ í•´ë¶€í•™(2)","category":"html"}}}}}